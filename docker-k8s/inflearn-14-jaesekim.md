## 노드 OS 업그레이드

커널 업그레이드, libc 업그레이드, 하드웨어 복구 등 노드를 재부팅해야 하는 상황이 있다. 노드를 갑자기 내리면 노드가 장애난 것을 인지하고 다른 노드로 파드을 옮기는 시간(default: 5분)동안 장애가 발생하게 된다. 따라서 아래 절차와 같이 노드를 계획성 있게 내려야 한다.

1. drain node
    - 해당 노드에 있는 파드들을 다른 노드로 이동(배수)시킨다. 만약 다른 노드에 자원이 없다면 pending 상태가 된다.
    - cordon node 명령어가 함께 실행된다. 해당 노드에 POD이 들어올 수도 나갈 수도 없게 (저지선을) 만든다. 해당 노드로 스케쥴링되지 않는다. (SchedulingDisabled)
2. update node
    - 노드를 업그레이드 한다. 1번 실행 시 해당 노드에는 파드가 없기 때문에 안정적으로 업그레이드 가능하다.
3. uncordon node
    - 해당 노드에 다시 파드들이 스케쥴링될 수 있다. 노드를 내릴 때 자원을 할당받지 못한 pending 상태의 파드들은 해당 노드로 배치된다.

## 쿠버네티스 버전 업데이트

v{MAJOR}.{MINOR}.{PATCH}

- e.g. v.1.14.1
- MAJOR
- MINOR: 특징, 기능 (API 버전명이 달라지는 경우도 있다.)
- PATCH: 버그 픽스

모든 버그를 고치기 위해 alpha와 beta로 나누어 출시 후 정식 버전 진행

- alpha: 추가되는 기능들을 disable한 형태로 배포
- beta: 추가 기능들을 enable한 형태로 배포
- release: 안정화된 버전을 배포

패키지마다 모든 컴포넌트는 동일한 버전으로 배포

- API 서버, 컨트롤러 매니저, 스케줄러, 큐블렛, 큐브프록시 등
- ETCD, 네트워크, CoreDNS 등 외부 프로젝트는 별도로 관리

보통 apiserver 기준으로 -1 마이너버전까지 호환이 된다. 따라서 마스터의 마이너 버전을 하나올리고 워커노드의 마이너버전을 하나 올리면 된다.

예제

- [https://blog.naver.com/isc0304/222506604980](https://blog.naver.com/isc0304/222506604980) (vm에 구성된 cluster를 통해 진행)
