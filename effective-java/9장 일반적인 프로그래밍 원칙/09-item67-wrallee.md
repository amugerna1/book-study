## 최적화는 신중히 하라

> 빠른 프로그램을 작성하려 안달하지 말자. 좋은 프로그램을 작성하다 보면 성능은 따라오게 마련이다. 하지만 시스템을 설계할 때, 특히 API, 네트워크 프로토콜, 영구 저장용 데이터 포맷을 설계할 때는 성능을 염두에 두어야 한다. 시스템 구현을 완료했다면 이제 성능을 측정해보라. 충분히 빠르면 그걸로 끝이다. 그렇지 않다면 프로파일러를 사용해 문제의 원인이 되는 지점을 찾아 최적화를 수행하라. 가장 먼저 어떤 알고리즘을 사용했는지를 살펴보자. 알고리즘을 잘못 골랐다면 다른 저수준 최적화는 아무리 해봐야 소용이 없다. 만족할 때까지 이 과정을 반복하고, 모든 변경 후에는 성능을 측정하라.

### 결론요약

1. 프로그램을 설계할 때 좋은 프로그램을 작성하려 노력하자 성능은 따라올 것이다.
2. 성능을 측정해보고 충분히 빠르다면 그걸로 완료한다. 자잘한 최적화는 의미없다.
3. 빠르지 않다면 프로파일러로 가장 큰 성능저하 요소를 찾자.
4. 일반적으로 사용한 알고리즘을 살펴보면 된다.
5. 만족할때까지 이 과정을 반복한다.

<br/>

이번 장에서는 최적화에 대한 판단 기준에 대해 이야기 하고 있다.

중요한점은 최적화는 보수적으로 해야하며, 하더라도 가장 메이저한 요소를 최적화해야한다는 점이다. 90%의 시간을 고민하고 10%의 시간동안 코드를 작성하기 때문에 자잘한 성능개선은 일을 하고도 안한것같은 단순히 시간낭비가 될 수 있다. 시간이 흐르면서 시스템은 더욱 복잡해지기 때문에 프로파일러와 같은 도구를 사용하여 성능을 측정하는것이 좋다.

<br/>

하지만 물론 설계 시 성능을 완전히 무시하라는 이야기는 아니다.

#### 빠른 프로그램보다는 좋은 프로그램을 작성하라

좋은 프로그램을 작성하는것만으로도 충분히 좋은 성능이 나온다.  
그리고 그렇지 않더라도 다음과 같은 장점이 있기 때문에 최대한 좋은 프로그램을 작성하는데 집중하자.

- 좋은 프로그램은 아키텍처 자체가 최적화 할 수 있는 길을 안내해줄 것이다.
- 좋은 프로그램은 정보 은닉 원칙을 따르기 때문에 개별 구성요소의 내부를 독립적으로 설계할 수 있다. 따라서 시스템의 나머지에 영향을 주지 않고도 각 요소를 다시 설계할 수 있다.

#### 성능을 제한하는 설계를 피하라


완성 후 변경하기가 가장 어려운 설계 요소는 컴포넌트끼리, 혹은 외부 시스템과의 소통 방식이다.

- API
- 네트워크 프로토콜
- 영구 저장용 데이터 포맷

위와 같은 요소들은 변경이 어렵거나 불가능 할 수 있고, 성능을 심각하게 제한할 수 있다.

#### API를 설계할 때 성능에 주는 영향을 고려하라

API의 구조도 성능을 제한하는 요소가 될 수 있다. 다음의 경우 성능이 제한될 수 있다.

- 불변성을 보장하지 않아 클라이언트측에 불필요한 방어적 복사를 유발하는 경우
- 컴포지션 대신 상속을 사용하여 부모의 성능제약을 물려받는 경우

하지만 다행히 일반적으로 잘 설계된 API는 성능도 좋다. 그러니 성능을 위해 API를 왜곡할 필요는 없다.

