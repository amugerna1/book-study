# 1장. 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션

# 목표

- 신뢰성, 확장성, 유지보수성의 의미 및 이를 고려하는 몇가지 방법

# 신뢰성, 확장성, 유지보수성
관련자의 기술 숙련도, 기존 시스템의 의존성, 전달 시간 척도, 다양한 종류의 위험에 대한 조직의 내성, 규제 제약 등은 설계에 영향을 줄 수 있는 많은 요소다. 이런 요소는 상황에 크게 좌우된다.
책에서는 대부분의 소프트웨어 시스템에서 중요하게 여기는 세가지 관심사에 중점을 둔다.

## 신뢰성

결함이 발생해도 시스템이 올바르게 동작하게 만든다는 의미이다.

잘못될 수 있는 일을 결함(fault)이라 부른다. 그리고 결함을 예측하고 대처할 수 있는 시스템을 내결함성(fault-tolerant) 또는 탄력성(resilient)을 지녔다라고 말한다.

- 하드웨어 오류
    - 최근에는 단일 장비 신뢰성보다 유연성(flexibility)과 탄력성(elasticity)을 우선적으로 처리하게끔 설계
    - 소프트웨어 내결함성 기술을 사용하거나 하드웨어 중복성을 추가해 전체 장비의 손실을 견딜 수 있는 시스템으로 옮겨가고 있다.
- 소프트웨어 오류
    - 소프트웨어의 체계적 오류문제는 신속한 해결책이 없다.
    - 시스템의 가정과 상호작용에 대해 주의깊게 생각하기, 빈틈없는 테스트, 프로세스 격리(process isolation), 죽은 프로세스의 재시작 허용, 모니터링 등 여러 작은 일들이 문제 해결에 도움을 줄 수 있다.
- 인적오류
    - 중단의 75~90% 원인
    - 오류의 가능성을 최소화하는 방향으로 시스템 설계, 비 프로덕션 샌드박스 제공, 철저한 테스트, 데이터 재계산 도구 제공(rollback, rollout 등), 모니터링 대책(알람, 메트릭), 조작교육과 실습

## 확장성

부하가 증가해도 좋은 성능을 유지하기 위한 전략을 의미한다.

- 부하기술하기
    - 가장 적합한 부하 매개변수(load parameter)은 시스템 설계에 따라 달라진다.
        - 웹서버의 초당 요청 수, 데이터베이스의 읽기 대 쓰기 비율, 대화방의 동시 활성자 수(active user), 캐시 적중률 등
- 성능 기술하기
    - 일단 시스템 부하를 기술하면 부하가 증가할 떄 어떤 일이 일어나는지 조사할 수 있다.
        - 부하 매개변수를 증가시키고 시스템 자원(CPU, 메모리, 네트워크 대역폭 등)은 변경하지 않고 유지하면 시스템 성능은 어떻게 영향을 받을까?
        - 부하 매개변수를 증가시켰을 때 성능이 변하지 않고 유지되길 원한다면 자원을 얼마나 많이 늘려야 할까?
    - 성능 수치
        - 처리량(throughtput): 초당 처리할 수 있는 레코드 수나 일정 크기의 데이터 집합으로 작업을 수행할 때 걸리는 전체 시간 (하둡 같은 일괄 처리 시스템들에서 관심)
        - 응답시간(response time): 클라이언트가 요청을 보내고 응답을 받는 사이 시간(온라인 시스템에서 중요), 요청을 처리하는 실제 시간(서비스 시간) 외에도 네트워크 지연과 큐 지연도 포함한다.
        - 지연시간(latency)은 요청이 처리되길 기다리는 시간으로, 서비스를 기다리며 휴지(latent) 상태인 시간을 말한다.
        - 동일한 시간이 걸려야 한다는 상황에서도 다양한 값을 얻게되는 이유는 백그라운 프로세스의 컨텍스트 스위치, 네트워크 패킷 손실과 TCP 재전송, 가비지 컬렉션 휴지(garbage collection pause), 디스크에서 읽기를 강제하는 페이지 폴트(page fault), 서버 랙의 기계적인 진동이나 다른 여러 원인으로 추가 지연이 생길 수 있다.
        - 일반적인 평균(산술평균)보다는 백분위(percentile)을 사용하는 편이 좋다.
            - 중앙값(median, p50): 중간 응답 시간이 200ms면 요청의 반은 200ms 미만으로 반환되고 나머지 반은 그보다 오래걸린다는 의미이다.
            - p95, p99, p999
            - 꼬리 지연 시간(tail latency)
                - 상위 백분위 응답시간은 서비스의 사용자 경험에 직접 영향을 주기 때문에 중요하다.
                - 아마존은 내부서비스의 응답시간 요구사항을 99.9분위로 기술한다.
                - 최상위 백분위는 통제할 수 없는 임의 이벤트에 쉽게 영향을 받기 떄문에 응답 시간을 줄이기가 매우 어려워 이점은 더욱 줄어든다.
                    - 99.99분위(10,000건의 요청 중 가능 느린 1건)를 최적화하는 작업에는 비용이 너무 많이 들어서 아마존이 추구하는 목표에 충분히 이익을 가져다주지 못한다고 여겨진다.
        - 꼬리지연증폭: 병렬로 호출해도 최종 사용자 요청은 여전히 병렬 호출 중 가장 느린 호출이 완료되길 기다려야 한다. 그래서 최종 사용자 요청 중 많은 비율의 응답 시간이 결국 느려진다.
- 부하 대응 접근 방식
    - 용량 확장(scaling up) = 수직확장(vertical scaling):: 좀 더 강력한 장비로 이동
    - 규모 확장(scaling out) = 수평확장(horizontal scaling): 다수의 낮은 사양 장비에 부하를 분산
        - 다수의 장비에 부하를 분산하는 아키텍처를 비공유(shared-nothing) 아키텍처라 부른다.
    - 탄력적(elastic): 부하 증가를 감지하면 컴퓨팅 자원을 자동으로 추가할 수 있다.
    - 확장성을 갖춘 아키텍처가 특정 애플리케이션에 특화됐을지라도 이런 아키텍처는 보통 익숙한 패턴으로 나열된 범용적인 구성 요소로 구축한다.(책뒤에서 설명한다고 함)

## 유지보수성

유지보수 고통을 최소화하고 레거시 소프트웨어를 직접 만들지 않기 위한 소프트웨어 시스템 설계원칙 세가지가 있다.

- 운용성(operability)
    - 운영팀이 시스템을 원활하게 운영할 수 있게 쉽게 만들어라.
    - 좋은 운용성이란 시스템의 건강 상태를 잘 관찰할 수 있고 시스템을 효율적으로 관리하는 방법을 보유한다는 의미이다.
- 단순성(simplicity): 시스템에서 복잡도를 최대한 제거해 새로운 엔지니어가 시스템을 이해하기 쉽게 만들어라(사용자 인터페이스의 단순성과는 다르다는 점에 유의하라).
- 발전성(evolvability): 엔지니어가 이휴에 시스템을 쉽게 변경할 수 있게 하라. 그래야 요구사항 변경 같은 예기치 않은 사용사례를 적용하기가 쉽다. 이 속성은 유연성(extensibility), 수정가능성(modifiability), 적응성(plasticity)으로 알려져 있다.
